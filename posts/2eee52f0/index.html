<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1"><link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222"><link rel="stylesheet" href="/css/main.css?v=7.4.1"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"7.4.1",exturl:!1,sidebar:{position:"right",display:"post",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!0,color:"#222",save:"manual"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"复制",copy_success:"复制成功",copy_failure:"复制失败"},sidebarPadding:40}</script><meta name="description" content="在领英的高速发展的过程中，之所以它能有这么高速发展与数据有不可分割的关系，领英像很多互联网公司一样，数据是它的核心，领英有自己的用户，通过自己提供的服务和用户交流，用户把自己的数据直接的或者间接地提供给领英，领英通过做各样的科研或者分析，可以提取出很多新的见识和认知，这些信息会被反馈到我们的产品上，这个产品就会做得更有效，可以吸引更多的用户到我们平台，所以如果数据做得好的话，可以形成一个非常好的良"><meta name="keywords" content="kafka演讲,饶军"><meta property="og:type" content="article"><meta property="og:title" content="【整理】饶军-Apache Kafka的过去、现在和未来"><meta property="og:url" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;index.html"><meta property="og:site_name" content="有翼"><meta property="og:description" content="在领英的高速发展的过程中，之所以它能有这么高速发展与数据有不可分割的关系，领英像很多互联网公司一样，数据是它的核心，领英有自己的用户，通过自己提供的服务和用户交流，用户把自己的数据直接的或者间接地提供给领英，领英通过做各样的科研或者分析，可以提取出很多新的见识和认知，这些信息会被反馈到我们的产品上，这个产品就会做得更有效，可以吸引更多的用户到我们平台，所以如果数据做得好的话，可以形成一个非常好的良"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;002.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;003.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;004.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;005.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;006.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;007.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;009.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;010.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;011.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;012.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;013.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;014.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;015.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;016.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;017.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;018.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;019.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;020.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;021.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;022.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;023.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;024.png"><meta property="og:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;025.png"><meta property="og:updated_time" content="2019-10-19T13:25:49.578Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https:&#x2F;&#x2F;huagetai.github.io&#x2F;posts&#x2F;2eee52f0&#x2F;002.png"><link rel="canonical" href="https://huagetai.github.io/posts/2eee52f0/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>【整理】饶军-Apache Kafka的过去、现在和未来 | 有翼</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">有翼</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">心若有翼，我自飞翔</p></div><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook" rel="section"><i class="fa fa-fw fa-comment"></i>留言</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="搜索..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://huagetai.github.io/posts/2eee52f0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content="worry"><meta itemprop="description" content="认真做事，踏实做人"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="有翼"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">【整理】饶军-Apache Kafka的过去、现在和未来</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-10-08 22:00:00" itemprop="dateCreated datePublished" datetime="2019-10-08T22:00:00+08:00">2019-10-08</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2019-10-19 21:25:49" itemprop="dateModified" datetime="2019-10-19T21:25:49+08:00">2019-10-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/kafka/" itemprop="url" rel="index"><span itemprop="name">kafka</span> </a></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/posts/2eee52f0/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/posts/2eee52f0/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>7.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>19 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>大家好，我大概简单的介绍一下，我叫饶军，我是硅谷的初创公司Conﬂuent的联合创始人之一，我们公司的三个创始人最开始都是在领英这个公司做kafka开发出身的。我们公司是2014年成立的，成立的宗旨想把公司做成一个帮助各种各样企业做基于kafka之上的数据流的事情。</p><!-- more --><h2 id="2010的领英"><a href="#2010的领英" class="headerlink" title="2010的领英"></a>2010的领英</h2><img src="/posts/2eee52f0/002.png"><p>在开始之前，我想大概做一个简单的调查，在座的有谁用过Kafka。大概有80%的人都用了。好，谢谢。今天跟大家分享，想分享一下我们的项目，Kafka的发展，它是怎么创建起来的，然后他的一些经历。说起Kafka的话，那就要回朔到2010年，在这个领域，我是在2010年加入领英，可能很多人都熟悉，这是一个提供人才和机会的社交平台。在2010年的时候，领英初具了一点规模，这也是领英高速成长的一个阶段。在2010年我加入领英的时候大概是600号员工，我是2014年离开领英，离开的时候已经发展到6000号员工，在短短的四年的过程这个组织高速发展。</p><h2 id="数据驱动"><a href="#数据驱动" class="headerlink" title="数据驱动"></a>数据驱动</h2><img src="/posts/2eee52f0/003.png"><p>在领英的高速发展的过程中，之所以它能有这么高速发展与数据有不可分割的关系，领英像很多互联网公司一样，数据是它的核心，领英有自己的用户，通过自己提供的服务和用户交流，用户把自己的数据直接的或者间接地提供给领英，领英通过做各样的科研或者分析，可以提取出很多新的见识和认知，这些信息会被反馈到我们的产品上，这个产品就会做得更有效，可以吸引更多的用户到我们平台，所以如果数据做得好的话，可以形成一个非常好的良性循环，用户可以得到更多的数据，可以做更好的分析，可以生产更好的产品，又可以吸引到更多的用户。</p><h2 id="数据源的多样性"><a href="#数据源的多样性" class="headerlink" title="数据源的多样性"></a>数据源的多样性</h2><img src="/posts/2eee52f0/004.png"><p>从数据上角度来讲，领英的数据是非常多元化的，最常见的数据，可能大家都知道这是一种——交易数据，这些数据一般是存在数据库里的，从领英的角度来讲，这种这种交易数据就很简单，你提供工作简历，或者你上学的一些简历，包括你和里面成员的连接关系，都是一种交易性的数据，但是还存在大量的非交易数据，一些很多用户的行为数据，比如说作为一个用户，你点了哪个连接，你输入哪些搜索的关键词，这些其实都是非常有价值的信息。从我们内部的运营来讲，有很多的运营服务指标，一些应用程序的日志，然后到最后我们很多智能手机上的一些信息，这也非常有价值。所以从价值来讲，这些非交易性的数据的价值不亚于这些交易性数据的价值。但是从流量上来讲，这些非交易型的数据的流量可能是这种交易性数据的一百倍，甚至一千万倍的数据源。下面就举一个小的例子，看看领英怎么用这些数据的理念提供这个服务。</p><h2 id="people-you-may-know"><a href="#people-you-may-know" class="headerlink" title="people you may know"></a>people you may know</h2><img src="/posts/2eee52f0/005.png"><p>英文叫做people you may know，简称PYMK，这个机构做的事情就是提供给领英的用户一些推荐，他想推荐一些其他的领英的用户，目前还没有在你的连接里，他这个推荐是怎么做的呢？它内部里要用到30到40种信息，把这些信息加起来，使得给你最后一个推荐。举一些简单的例子，比如说我们两个人去过同一个学校，或者在一个公司工作过，这是一个很强的信息，也许我们就是需要连接在一起，但是有很这种非直接的信息，比如说甲和乙两个人，他们没有直接这种共同的一些明显的关系，但是如果在某一个很短的时间，有很多人同时看到这两个人的简历，那说明他们可能还有一些这种隐藏的信息，使得他们值得连在一起。所以在早期的领英，大家使用这个服务的话，就会发现很多的推荐非常神奇。你乍一看的话，可能觉得他怎么会推荐这么一个人给我，但是你如果细想一下，就会发现它有很多很强的理由，确实是有些道理，类似的在里面还有很多的服务，使得他可以用到各种各样的实时数据。但当时在2010年的时候，我们领英有很大的一块问题，就是在数据的集成上，其实是一个非常不完善的过程。这个图大概就介绍了一下当时的状态，所以在上面我看到这是各种各样的数据源，领英最开始是一个老牌的互联网公司，所有的数据都是存在数据库里头，随着理念的发展，我有一个系统是收集所有的用户行为的数据，很多的数据都是存在本地的文件里，还有一些其他的信息是存在运行上的日志里，运行一些识别监测数据。</p><p>在下游我们可以看到这是各种各样的消费端，领英最开始有这种数据仓库，随着时间的推移，我们有越来越多实时的微服务，它和这些批处理差不多，也要夺取或多或少同样的从这些不同数据源而来的信息。像我们刚才讲到的这种推荐引擎，它是其中的一个微服务，我们有很多这样的，还有一些社交的图形处理，他可以分析两个节点之间，比如两个领英的成员，他们之间是怎么连起来的，哪个连接是最强，还有一些实时的搜索，所以这些数量逐渐增多，而且他们很多的用法是更加的实时，从数据产生到它更新的系统，很多时候是几秒，甚至更短的一些延时。</p><h2 id="点到点的数据集成"><a href="#点到点的数据集成" class="headerlink" title="点到点的数据集成"></a>点到点的数据集成</h2><img src="/posts/2eee52f0/006.png"><p>所以当时我们的做法是，如果想把这些数据送到从数据源送到消费端的话，做法就是我们说的点到点的数据集成，我们知道有些数据，我们想要的是把这些数据送到数据仓库里，我们的做法是写下脚本或者写一些程序。过了几天，我们发现很多系统里也需要读数据，我们又会做一些类似的工作，又在写下脚本一些程序，所以我们一直在很长一段时间都在做这种类似的东西，但是我写了五六个类似的数据流之后，发现这是一个非常低效的做法。主要的问题是什么？第一个我们要解决的问题是一个叉乘问题，是和数据员和数据消费端叉乘的问题。所以每增加一个数据源，就要把这个数据源和所有的消费端都连起来，同样增加一个消费端的话，消费端需要和所有的数据源直接连接。第二个问题就是我们在做这种点到点的流数据流的时候，每做一个数据流，我们都要重复很多相同的工作，另外每一个数据源，我们都没有足够的时间把它做到百分之百的尽善尽美，所以我们觉得这个体系结构不是非常理想。</p><h2 id="理想架构"><a href="#理想架构" class="headerlink" title="理想架构"></a>理想架构</h2><img src="/posts/2eee52f0/007.png"><p>那么如果要改进的话，应该改进成什么样？我们当时想如果有这么一个体系结构，假设中间这个地方我们有一个集中式的日志系统，能够把所有数据源的信息先缓存住，如果能做到这一点，我们就会把这个框架大大的简化。所以你如果是数据源的话，你不需要知道所有的消费端，你唯一要做的事，就是把你的数据发送给中央的日志系统。同样你如果是一个消费端的话，你也不需要知道所有的数据源，你做的事情只是要像这种中央的日志系统去订阅你所要的消息，所以我们就把刚才叉乘问题简化成一个现实问题，关键的就是在体系结构里头，什么样的系统可以做这个中央的日志系统，所以这是我们当时在讨论的事情，我们最开始的话也没有想重新造一个新的系统，这个好像是一个非常常见的企业级的问题，那这个企业里应该有一个类似的解决方法。</p><h2 id="首先尝试：不想重复造轮子"><a href="#首先尝试：不想重复造轮子" class="headerlink" title="首先尝试：不想重复造轮子"></a>首先尝试：不想重复造轮子</h2><img src="/posts/2eee52f0/009.png"><p>如果你仔细看一看，想一想，中央日志系统从界面角度来讲，类似于传统的消息系统。我们的消息系统一般把这种生产端和消费端分开，然后又是一个非常实时的系统，所以我们想为什么不尝试一些现有的消息系统，当时又有一些开源的消息系统，还有一些企业级的消息系统，但我们发现效果非常的不好。具体的原因有很多，但是最重要的一个原因就是这些传统的消息系统，从它的设计上来讲，不是给我们这个用法来设计的，尤其最大的问题就是它的吞吐量。</p><h2 id="Kafka第一版：高吞吐发布订阅消息系统"><a href="#Kafka第一版：高吞吐发布订阅消息系统" class="headerlink" title="Kafka第一版：高吞吐发布订阅消息系统"></a>Kafka第一版：高吞吐发布订阅消息系统</h2><img src="/posts/2eee52f0/010.png"><p>很多的这种早期的消息，他的设计师给这些数据库上的数据，这种消费交易型数据来设计，但是你可能很难想象把很多非交易性数据，比如说用户行为日志，还有一些这种监测数据，都通过这种传统的消息来流通。所以在这种情况下，我们觉得我们没有办法解决这个问题，但又没有一个现成的结果，那么就说我们自己来做一个事情。在2010年左右，我们做了开始做kafka的第一个版本。第一个版本我们的定位也很简单，就想把它做成一个高吞吐的消息系统，高存储是我们最重要的目的。</p><h2 id="分布式架构"><a href="#分布式架构" class="headerlink" title="分布式架构"></a>分布式架构</h2><img src="/posts/2eee52f0/011.png"><p>下面的话，我们大概讲讲我们怎么实现高吞吐。第一件事我们做了高吞吐，就是把在咖啡的第一个版本里，我们就把它做成一个分布式的框架。很多熟悉kafka的人都知道，kafka里面有三层，中间这层加服务层下面是生产端，然后下面是消费端。服务端的话一般有一个或者多个节点，基本的概念叫做消息拓片，这个消息源是可以分区的，每一个分区可以放到某一个节点的某一个硬盘上，所以如果想增加吞吐的话，最简单的方法就是增加集群里的机器，可以有更多的资源，不管是从存储还是带宽的角度，你都可以有更多的资源来接受很多的数据，同样我们生产端和消费端做的也是一个这种多线程的设计。在任何一个情况下，你可以有成千上万的这种生产端的线程和消费端的线程，从喀斯特机群上写或者读取数据。所以这个设计就是说在我们第一个班级有的东西很多，这种老牌的一些消息系统。</p><h2 id="简单实用的日志存储"><a href="#简单实用的日志存储" class="headerlink" title="简单实用的日志存储"></a>简单实用的日志存储</h2><img src="/posts/2eee52f0/012.png"><p>第二点我们做的是使用了一个日志的存储结构，这个也非常简单，但是它是一个非常有效的存储结构，所以大概是它的一些结构的话是每一个消息源的分区，都会有一个相对应的这么一个日志结构，而且日志结构式和硬盘挂在一起的所有会是通过硬盘来存储的。这个结构里面就是每一个小方块都对应了一个消息，每一个消息有一个代号，代号是连续增加的，如果你是一个生产端的话，你做的事情就是你把你要写的消息写到日志的最后面，你会得到一个新的更大的消息代号日志，再送到给消费端的话是按顺序送的，你按什么顺序写进去，他就按什么顺序送给消费端，这样的好处是，从消费端来讲你的开销非常的小，因为不需要记住所有消费端的消息，只需要记住它最后消费过的一个消息的代号。然后记住这个的话，它就可以从这个地方往后继续消费，因为我们知道所有的消息都是按顺序去做发送的，所以在这个消息之前的所有消息应该已经全都被消费过了。</p><h2 id="两个优化"><a href="#两个优化" class="headerlink" title="两个优化"></a>两个优化</h2><img src="/posts/2eee52f0/013.png"><p>这个设计有几个好处，第一个好处就是他的访问的模式非常利于优化，因为不光是从写的角度还是从读的角度来讲，这个都是线性的写，读也是从某一个位置开始线性的读。所以从这个角度出发，利于操作系统和文件系统来优化它的性能。第二点，我们这个系统设置上可以支持同时多消费，在任何时候你可以有一个或者多个消费者，消费者他可以说从这个地方开始消费，另一个消费者可以从一个不同的地方再消费，但不管你有多少个消费者，这个数据只是存一次，所以从存储的角度来讲，它的性能和你消费的次数是没有关系的。另外一点并不是很明显的，由于我们日志是存在硬盘上的，使得我们可以同时接收实时的消费者，也可以接受一些不实时的批处理的消费者。但是因为所有的数据都在硬盘上，我们可以有一个非常大的缓存，所以不管你是实时还是不实时的，从消费者端的服务方法都是一套的，他不需要做不同的优化，唯一的就是我们依赖这种操作系统来决定哪些数据是可以从内存里提供给消费者，哪些需要从硬盘里来读。但是从这个框架的设计上都是一样的。最后一点我们做成这种高吞吐，我们又做了两个小的优化，这两个优化是有关联的，第一个优化就是批处理，所有三个层面在服务端，刚才我们说到这些消息是要存在一个基于硬盘的日志里，但是写到硬盘的话它是有一定的开销，所以我们不是每一个消息就马上写了这个硬盘，而是一般会等一段时间，当我们积攒了一些足够的消息之后，才把他一批写到硬盘，所以虽然你还有同样的开销，但你这个开销是分摊到很多消息上，同样在生产端也是这样，如果你想发送一个消息，我们一般也不是马上就把这个消息作为一个远程的请求发送给这个服务端，而是我们也会等一等，希望能够等到一些更多的消息，把他们一起打包送到这个服务端。和批处理相关的就是数据压缩，我们压缩也是在一批数据上进行压缩，而且是从端到端的压缩，如果你开启压缩的功能的话，再生产端我们先会等一批数据等到一批数据完成之后，我们会把这一批数据一起做一个压缩，击压缩一批数据，往往会得到比这个压缩每一个消息得到更好的压缩比例也是。不同的消息往往会有一些这种重复，然后压缩的数据会被从生产端送到这个服务端，那服务端会把数据压缩的格式存在日志里头在以压缩的格式送到消费端，直到消费端在消费一个消息的时候，我们才会把这个消息解压。所以如果你启动了压缩的话，我们不光节省了网络的开销，还节省了这个寄存开销，所以这两个都是非常有效的实现这种高吞吐的方法。所以我们第一个版本kafka做了大概有半年左右的时间，但是我们又花了更多的一点时间把它用到领英的数据线上，因为领英内部有很多的微服务，大概在我们2011年底的时候做完了这件事，这是当时的一些基本的数量。</p><h2 id="kafka在领英2011"><a href="#kafka在领英2011" class="headerlink" title="kafka在领英2011"></a>kafka在领英2011</h2><img src="/posts/2eee52f0/014.png"><p>生产端我们当时有几十万的消息被生产出来，然后有上百万的消息被消费，这个数据在当时还是非常的可观，而且领英当时有几百个微服务，上万个微服务的线程，更重要的是我们在做了这个事情之后，实现了这个领域内部的一个数据的民主化。在没有kafka之前，你如果是领英的一个工程师或者是一个产品经理，或者是一个数据分析家，你想做一些新的设计或者新的这种应用程序，最困难的问题是你不知道应该用什么样的界面去读取，也不知道这个数据是不是完整。做了kafka这件事情，我们就把这一块的问题大大的简化了，大大解放了工程师创新的能力。所以有了成功的经历，并且感觉kafka的这个系统非常有用，我们又往后做了一些更多的开发，第二部分的开发主要是做一些这种高可用性上的支持。</p><h2 id="Kafka第二版：高可用性"><a href="#Kafka第二版：高可用性" class="headerlink" title="Kafka第二版：高可用性"></a>Kafka第二版：高可用性</h2><img src="/posts/2eee52f0/015.png"><p>第一个版本里的话，每一个消息只是被存在一个节点上，如果那个节点下机的话，那这个数据就没法获取了。如果这个机器是永久性的损坏的话，你的数据还会丢失。所以第二版我们做的时候，就是增加了一些这种高可用性，实现方法就是增加的这种多副本的机制。如果群里有多个节点的话，那我们可以把一个消息冗余的存在多个副本上，同一个小的颜色是多个不同的副本。在同样的情况，如果你一个机器下线的话，另外一个迹象，如果还有同样的副本，他还可以继续持续提供同样数据的服务。所以有了第二个版本之后，我们就可以把它可能够包括的数据的面能够拓展得更广一点，不光是这种非交易性的时候，一些包括交易性的数据，也可以通过我们的系统来被收集。</p><h2 id="Kafka于2011年加入Apache"><a href="#Kafka于2011年加入Apache" class="headerlink" title="Kafka于2011年加入Apache"></a>Kafka于2011年加入Apache</h2><img src="/posts/2eee52f0/016.png"><p>在2000年我们还做了一件事，那一年是kafka这个项目被捐赠给了阿帕奇基金会，当时我们做这个事也是觉得我们做的系统至少对领域内部非常有用，那我们就看看是不是对其他的公司也有一些用处，其他的互联网公司也许也觉得有用，但是我没有意识到开源了之后，他用途是非常广泛，所以往往是布局网，不只是局限于这种互联网的公司而是整个工业界。只要你的公司有些这种实时数据，你需要收集的话都可以用得上。很大的原因是一些各种各样的传统的企业，它也在经历这种软件化数字化的过程。有一些传统行业，以前强的地方可能是在那些传统的制造业，或者说有一些零售点，但现在必须在软件上或在数据上也能够比较强才可以。那kafka就从实时这种数据的集成上，给很多企业都提供了非常有效的渠道。</p><h2 id="Confluent于2014年成立"><a href="#Confluent于2014年成立" class="headerlink" title="Confluent于2014年成立"></a>Confluent于2014年成立</h2><img src="/posts/2eee52f0/017.png"><p>在下一步我们经历了几年kafka的开发，知道它用途越来越广，所以我们就想做一件致力于kafka上的事，因为这个事是全职性的工作，所以我们在2014年就离开了领英成立了Conﬂuent公司。这个公司我们是想为各种各样的企业提供方便，用的可以更广一点，现在我们的公司大概是有超过两百人。</p><h2 id="Kafka的发展"><a href="#Kafka的发展" class="headerlink" title="Kafka的发展"></a>Kafka的发展</h2><img src="/posts/2eee52f0/018.png"><p>下面大概讲一讲从14年之后我们做了哪些发展。在这之后，kafka我们主要做了两块的东西，第一块和企业级的功能有关的东西，这块主要是和数据集成有关的。第二块是和数据流处理有关的。那么两方面都会稍微讲一讲。这个就跳过去了，在企业界上我们做了很大的一块，和刚才我们最开始讲的数据集成的事情有关。很多的这种公司，如果你的公司时间比较长的话，你会发现你数据源是分散在很多的系统里，刚才我们讲的就是有kafka之后很方便，你可以把这些数据提取出来，但是不同的公司的话，你不希望每个公司都读东西来做他们自己的一套东西，所以我们设计的初衷中有两块，第一块是它有一个平台部分，里面它把很多常见的东西提取出来，做成一个模块，比如说你需要做一些数据的分布，你需要做一些并行处理，你还需要做一些这种失败检测，检测之后你能再做一些数据平衡，所以这些常见的东西都做到这个模块里面，这个模块里面又有一个开放式的接口，这个接口可以用来设计实现各种各样的不同的数据源的连接。在数据的发送端的地方，如果想搜索一些副本，我们也可以做一些类似的事情，所以这是我们做的第一块。</p><p>第二块做的就是和数据流有关的一个方面。如果你有一个系统，像kafka里能实时把很多的数据收集起来，最开始的用途是当成一个数据传输的平台。但是我们觉得加以时间的话，kafka可能并不只局限一个传输平台，而且还可以做这种分享合作的平台，有实时数据之后，你常做的一些事情比如说你要做一些这种数据流的出来，比如说把一个数据从一个格式转到另外一个格式，你可能还想做一些数据的扩充，比如说你有一个数据流，里面有一些数据的信息，但只有用户的代号，没有数据的用户的具体信息，但是你有一个可能数据库里有很多更详细的用户的信息，如果您能够把这两个信息并在一起，这个数据流就更丰富，可以使你做一些更多的更有效的处理。另外你可能也想做一些实时的数据的聚合，应用程序里，我们想把这一块再简化。</p><h2 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h2><img src="/posts/2eee52f0/019.png"><h2 id="Kafka-connect"><a href="#Kafka-connect" class="headerlink" title="Kafka connect"></a>Kafka connect</h2><img src="/posts/2eee52f0/020.png"><h2 id="数据流处理"><a href="#数据流处理" class="headerlink" title="数据流处理"></a>数据流处理</h2><img src="/posts/2eee52f0/021.png"><h2 id="Kafka-Streams"><a href="#Kafka-Streams" class="headerlink" title="Kafka Streams"></a>Kafka Streams</h2><img src="/posts/2eee52f0/022.png"><h2 id="KSQL"><a href="#KSQL" class="headerlink" title="KSQL"></a>KSQL</h2><img src="/posts/2eee52f0/023.png"><h2 id="Kafka的未来"><a href="#Kafka的未来" class="headerlink" title="Kafka的未来"></a>Kafka的未来</h2><img src="/posts/2eee52f0/024.png"><p>未来的话，我觉得kafka系统不光是一个实时的数据收集和传输的平台，更多的可能随着时间发展的话，它可能还是更多的数据流的处理，交换和共享的一个平台，所以我们会在这个方向上做更多的东西。未来随着很多的应用更广，我们觉得很多的应用程序会越来越变成这种实时的应用程序。所以在这个基础上，我们在kafka上可能会有很强的一套生态系统。</p><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><img src="/posts/2eee52f0/025.png"><p>最后给大家分享一个小的故事。这个故事是是我们北美的一个用户，这个银行是一个比较传统的老牌银行，已经是几十年的一个历史银行，很长时间存在的一个问题是它的数据是非常的分分散的。所以你如果是这个银行的客户，你可能有一个银行的账户，你可能有一个贷款，你可能还有一个保险，你可能还有一张信用卡，以前所有这个客户的信息，因为它都是不同的商业部门，它都是完全分开的。你如果作为一个银行的销售人员，你苦恼的事就是没法知道这个客户的所有的信息。这个公司它做了一个和Kafka有关的项目，一个项目就是把所有的客户的不同的数据源信息都实时地收集起来，然后把这个信息推提供给他们上万个销售人员，这样的话销售人员在做销售的时候，就会有更有效的一些实时信息可以给客户做一些更有针对的推荐，所以这个项目就非常成功。</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/kafka%E6%BC%94%E8%AE%B2/" rel="tag"><i class="fa fa-tag"></i> kafka演讲</a> <a href="/tags/%E9%A5%B6%E5%86%9B/" rel="tag"><i class="fa fa-tag"></i> 饶军</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/posts/4161d32c/" rel="next" title="kafka介绍"><i class="fa fa-chevron-left"></i> kafka介绍</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/posts/9bcd2d2c/" rel="prev" title="kafka设计思想">kafka设计思想 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div><div class="tabs tabs-comment"><ul class="nav-tabs"><li class="tab"><a href="#comment-valine">valine</a></li><li class="tab"><a href="#comment-gitalk">gitalk</a></li></ul><div class="tab-content"><div class="tab-pane valine" id="comment-valine"><div class="comments" id="comments"></div></div><div class="tab-pane gitalk" id="comment-gitalk"><div class="comments" id="gitalk-container"></div></div></div></div><script>window.addEventListener('tabs:register', () => {
          let activeClass = 'valine';
            activeClass = localStorage.getItem('comments_active') || activeClass;
          if (activeClass) {
            let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
            if (activeTab) {
              activeTab.click();
            }
          }
        });
        window.addEventListener('tabs:click', event => {
          let commentClass = event.target.classList[1];
          localStorage.setItem('comments_active', commentClass);
        });</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2010的领英"><span class="nav-number">1.</span> <span class="nav-text">2010的领英</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据驱动"><span class="nav-number">2.</span> <span class="nav-text">数据驱动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据源的多样性"><span class="nav-number">3.</span> <span class="nav-text">数据源的多样性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#people-you-may-know"><span class="nav-number">4.</span> <span class="nav-text">people you may know</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#点到点的数据集成"><span class="nav-number">5.</span> <span class="nav-text">点到点的数据集成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#理想架构"><span class="nav-number">6.</span> <span class="nav-text">理想架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#首先尝试：不想重复造轮子"><span class="nav-number">7.</span> <span class="nav-text">首先尝试：不想重复造轮子</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka第一版：高吞吐发布订阅消息系统"><span class="nav-number">8.</span> <span class="nav-text">Kafka第一版：高吞吐发布订阅消息系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#分布式架构"><span class="nav-number">9.</span> <span class="nav-text">分布式架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#简单实用的日志存储"><span class="nav-number">10.</span> <span class="nav-text">简单实用的日志存储</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#两个优化"><span class="nav-number">11.</span> <span class="nav-text">两个优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#kafka在领英2011"><span class="nav-number">12.</span> <span class="nav-text">kafka在领英2011</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka第二版：高可用性"><span class="nav-number">13.</span> <span class="nav-text">Kafka第二版：高可用性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka于2011年加入Apache"><span class="nav-number">14.</span> <span class="nav-text">Kafka于2011年加入Apache</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Confluent于2014年成立"><span class="nav-number">15.</span> <span class="nav-text">Confluent于2014年成立</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka的发展"><span class="nav-number">16.</span> <span class="nav-text">Kafka的发展</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据安全"><span class="nav-number">17.</span> <span class="nav-text">数据安全</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-connect"><span class="nav-number">18.</span> <span class="nav-text">Kafka connect</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据流处理"><span class="nav-number">19.</span> <span class="nav-text">数据流处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka-Streams"><span class="nav-number">20.</span> <span class="nav-text">Kafka Streams</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KSQL"><span class="nav-number">21.</span> <span class="nav-text">KSQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka的未来"><span class="nav-number">22.</span> <span class="nav-text">Kafka的未来</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结尾"><span class="nav-number">23.</span> <span class="nav-text">结尾</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="worry" src="/images/avatar.gif"><p class="site-author-name" itemprop="name">worry</p><div class="site-description" itemprop="description">认真做事，踏实做人</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/huagetai" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;huagetai" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:xiaochawan@126.com" title="E-Mail &amp;rarr; mailto:xiaochawan@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">worry</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span title="站点总字数">70k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:55</span></div><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5dabd646b34cdc5c" async></script></div><div style="display:none"><script src="//s95.cnzz.com/z_stat.php?id=1000294390&web_id=1000294390"></script></div></div></footer></div><script src="/lib/anime.min.js?v=3.1.0"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script><script src="/js/schemes/pisces.js?v=7.4.1"></script><script src="/js/next-boot.js?v=7.4.1"></script><script src="/js/bookmark.js?v=7.4.1"></script><script src="/js/local-search.js?v=7.4.1"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"><script>NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '9a74dfd7f89e23278636',
      clientSecret: 'b094b8a3e7018d48e6399825701002decd060d45',
      repo: 'huagetai.github.io',
      owner: 'huagetai',
      admin: ['huagetai'],
      id: '7a8f68e2b42586886f9c701c22f58b61',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);</script><script>NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'MXw3KxWl0E0BqCmpb5hiJKlE-gzGzoHsz',
    appKey: 'ReqVUSvH190npS0g6Y7R9XIG',
    placeholder: "Just go go",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);</script></body></html>